# 1. 规约模式

## 1.1. 目录

<!-- TOC -->

- [1. 规约模式](#1-规约模式)
    - [1.1. 目录](#11-目录)
    - [1.2. 讨论](#12-讨论)
    - [1.3. 什么时候使用？](#13-什么时候使用)
    - [1.4. 什么时候不使用？](#14-什么时候不使用)

<!-- /TOC -->

规约模式 是一种特别的软件设计模式，通过链接业务规则与使用boolean逻辑来重组业务规则。

实际上，它主要是用来对实体和其它业务对象构造可重用的过滤器。

## 1.2. 讨论

虽然规约模式比C#的lambda表达式老旧。一些开发者认为可以不用使用了，我们可以直接的传入表达式给仓储或者领域服务；如下所示：

```c#
var count = _customerRepository.Count(c => c.Balance > 100000 && c.CreationYear == 2017);
```

ABP的仓储支持表达式用法，这是完全有效的用法。你可以不在应用中定义或者使用规约，你可以直接使用Linq表达式。那么，规约的意义是什么？为什么要使用规约以及什么时候我们该使用规约？

## 1.3. 什么时候使用？

使用规约的好处：

- 重用：你在应用程序的很多地方都需要过滤高级客户。如果你使用Linq表达式而不创建规约；如果你迟些时候改变了 "高级客户" 的定义，那会发生什么？(例如：你想将客户的资产从$100,000调到$250,000，并且你还要添加其它过滤条件：客户年龄超过30岁)。如果你使用了规约，你仅仅只需要改变一个类。如果你使用Linq表达式，那么你需要在很多地方来改变表达式过滤。

- 组合：你可以组合多个规约来创建一个新的规约。这是另一种可重用的类型。

- 有意义的命名：相较于一个复杂的表达式，PremiumCustomerSpecification能够更好的表达它的意图。如果在你的业务中使用了一个有意义的表达式，那么请考虑使用规约。

- 测试：可以对规约分别测试，这样测试更简单。

## 1.4. 什么时候不使用？

- 无业务表达式：对于与业务不相关表达式和操作，你可以不使用规约。

- 报表：如果你只是创建报表，那么没必要使用规约，可以直接的使用IQuerable。实际上，对于报表你可以使用纯SQL，视图或者其它工具。DDD对于报表不是十分关注；从性能的角度看，更应该优化查询来获取底层数据。