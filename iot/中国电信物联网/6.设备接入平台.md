# 设备接入平台

设备上电后，使用串口工具配置设备，按照如下AT命令顺序执行即可：

1. AT+CMEE=1 报错查询
2. AT+CFUN=0 关机，设置 IMEI 和平台 IP 端口前要先关机AT+CGSN=1 查询 IMEI，IMEI 即为设备标识，应用注册设备时nodeId/verifyCode 都需要设置成 IMEI
3. AT+NTSETID=1,xxxx,xxxx 为 IMEI。如果查询不到可自行设置 IMEI，IMEI 必须是唯一的，不能与其他设备重复，且只能设置一次。IMEI 即为设备标识，应用调用 API 注册设备时，如果设备使用的是海思芯片nodeId/verifyCode 都需要设置成 IMEI，如果设备使用的是高通芯片 nodeId/verifyCode 都需要设置成 urn:imei:IMEI。
4. AT+NCDP=180.101.147.115,5684 设置对接的平台 IP 端口，5683 为非加密端口，5684 为加密端口
5. AT+CFUN=1 开机
6. AT+NBAND=5 设置频段
7. AT+CGDCONT=1,"IP","CTNB" 设置核心网 APN，APN 与设备的休眠、保活等模式有关，需要与运营商确认。电信物联网开放平台 APN 见下方的图表。
8. AT+CGATT=1 入网
9. AT+CGPADDR 获取终端 IP
10. AT+NMGS=2,0001 发送上行数据，第 1 个参数为字节数，第 2 个参数为上报的 16 进制业务码流
11. AT+NQMGR 接收下行数据
12. AT+NMGR 读取数据
> 使用用非加密端口接入时，只需要使用原生的 CoAP 协议进行传输，同时将对接平台设置为 5683 即
可。

## 设备上线

* 真实设备

    完成这一步时，设备已经可以接入到平台。配置好网络，开启设备，观察设备是否成功接入到平台。登陆开发者 Portal，在我的设备列表页面，查看设备状态，字段设备 ID 即为在第三步里注册设备时生成的设备 ID，状态字段表示设备的在线状态，如果状态是在线（online）表示设备已经成功的接入到平台，接着就可以接收设备的数据。

* 模拟设备

    登录开发者 portal，选择模拟器->NB 设备模拟器->绑定设备，在弹出的对话框中输入验证码（即设备标识、IMEI），点击确定即可。

    绑定成功后就可以直接使用设备模拟器发送业务码流

    上报并解析成功后可以在开发者 portal->我的设备->点击要查看的设备进入设备详情->历史数据中查看设备数据
