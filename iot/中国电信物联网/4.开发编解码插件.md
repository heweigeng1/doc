# 开发编解码插件

NB-IoT 设备和中国电信物联网开放平台之间采用 CoAP 协议通讯，CoAP 消息的数为应用层数据，应用层数据的格式由设备厂商自行定义。由于 NB-IoT 设备对省电要求通常较高，所以应用层数据一般采用二进制格式。应用层数据在中国电信物联网开放平台做协议解析时，会转换成统一的 json 格式，以方便应用服务器使用。要实现二进制消息与 json 格式消息的转换功能，中国电信物联网开放平台需要使用设备厂商提供的编解码插件。一款设备对应一个编解码插件

开发编解码插件的两种方式

* 开发者 Portal 在线插件开发
    [指导视频](http://www.tianyiiot.com/downloadZone/downloadZones.html)
    >此方式实现了无码化的开发，开发复杂度低；适用于二进制消息和 json 格式消息不需经过计算，直接相互转换的场景；但并不适用于二进制消息和 json 格式消息需要计算后再转换的场景

在线开发的步骤大致如下:
    登录开发者portal->插件开发->插件开发（子菜单）->开始设计->新建插件->选择Profile（请等待 profile 加载完成后再选择对应 profile）->点击确定

* 离线完成插件开发
    >使用 Java 语言开发，开发复杂度相对方式一更高，适用于全部场景

编解码插件开发可参考[中国电信物联网开放平台编解码库开发与升级指南](http://www.tianyiiot.com/statics/shtml/y29odry3sck27lp.html)文档，文档详细介绍了需要实现的 4 个接口，同时附带了样例代码

* 插件的质检

    >编解码插件的质检是检测编解码是否能够正常使用的关键步骤，请参照编解码插件检查工具说明，来进行操作.[插件地址](http://www.tianyiiot.com/attchment/174/中国电信物联网开放平台编解码插件检测工具.zip).

* 对插件包进行离线签名
    当编解码插件开发完后，在安装到平台之前，需要先对插件包进行签名。此时需要下载离线签名工具并进行签名操作。操作步骤如下
    1. 打开管理页面.
    2. 单击左侧导航栏“工具”，在右侧区域单击“下载”，下载离线签名工具
    3. 在下载路径找到压缩包“signtool.zip”，右键菜单中选择“Extract to signtool\”解压缩至文件夹signtool
    4. 进入 signtool 文件夹，运行“signtool.exe”
    5. 生成数字签名公私钥对。
    6. 对软件包进行数字签名。
    7. 软件包签名验证。
    > 第5、6 、7步的操作具体请看[PDF](http://www.tianyiiot.com/attchment/207/%E4%B8%AD%E5%9B%BD%E7%94%B5%E4%BF%A1%E7%89%A9%E8%81%94%E7%BD%91%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0_NB-IoT%E4%B8%9A%E5%8A%A1%E5%AF%B9%E6%8E%A5%E6%8C%87%E5%AF%BC%E4%B9%A6_v1.2.pdf)

* 最后是上传公钥及签名后的插件包

    >编解码插件化能够动态的新增编解码库，这样新增设备接入时，只需要把对应的编解码库动态导入到平台，就能够兼容新增的设备。请将公钥以及签名后的插件包发送给中国电信物联网开放平台支持人员，由中国电信完成公钥和签名后的插件包的上传配