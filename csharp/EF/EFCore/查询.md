# 1. 查询

## 1.1. 目录

<!-- TOC -->

- [1. 查询](#1-查询)
    - [1.1. 目录](#11-目录)
    - [1.2. 预先加载](#12-预先加载)
        - [1.2.1. Include](#121-include)
        - [1.2.2. ThenInclude](#122-theninclude)

<!-- /TOC -->

## 1.2. 预先加载

### 1.2.1. Include

Include 方法来指定要包含在查询结果中的相关数据

```c#
private static User SelectUser()
{
    using (var db = new FristContext())
    {
        return db.Users.Include(user => user.UserLog).FirstOrDefault();
    }
}
```

这个查询会在数据库执行2个SQL语句

```sql
SELECT TOP(1) [user].[Id], [user].[Creatime], [user].[UserName], [user].[Id], [user].[Pasons_Age]
FROM [Users] AS [user]
ORDER BY [user].[Id]
```

```sql
SELECT [user.UserLog].[Id], [user.UserLog].[LogDec], [user.UserLog].[LoginTime], [user.UserLog].[UId]
FROM [UserLogs] AS [user.UserLog]
INNER JOIN (
    SELECT DISTINCT [t].*
    FROM (
        SELECT TOP(1) [user0].[Id]
        FROM [Users] AS [user0]
        LEFT JOIN [Users] AS [user.Pasons0] ON [user0].[Id] = [user.Pasons0].[Id]
        ORDER BY [user0].[Id]
    ) AS [t]
) AS [t0] ON [user.UserLog].[UId] = [t0].[Id]
ORDER BY [t0].[Id]
```

### 1.2.2. ThenInclude

包括多个查询

```c#
private static User ThenIncludeSelect() {
    using (var db=new FristContext())
    {
      var data=  db.Users
            .Include(user => user.UserLog)
                .ThenInclude(userlog => userlog.Logs).FirstOrDefault();
        return data;
    }
}
```

> 具体的SQL语句就有兴趣的小伙伴到sql profiler去监听一下看看. EFcore 生成的语句比以前简洁很多.