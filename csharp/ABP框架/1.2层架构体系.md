# 1. 层架构体系

> ABP遵循DDD（领域驱动设计）的原则，将工程分为四个层.
* 展现层(Presentation):使用应用层和UI(用户)交互.
* 应用层(Application):展现层与领域层交互的中间层,协调业务对象去执行对应的任务.
* 领域层(Domain):包括业务对象,和业务规则.是程序的核心层.
* 基础设施层(Infrastructure):提供通用的技术来支持上层,譬如发送短信.
> 根据需要可以扩展额外的层,譬如分布式服务层.

## 1.1. 目录

<!-- TOC -->

- [1. 层架构体系](#1)
    - [1.1. 目录](#11)
    - [1.2. 领域层(domain)](#12-domain)
    - [1.3. 应用层(Application)](#13-application)
    - [1.4. 基础设施层(Infrastructure)](#14-infrastructure)
    - [1.5. 展现层](#15)
    - [1.6. 其它](#16)

<!-- /TOC -->

## 1.2. 领域层(domain)

> 领域层是实现所有业务规则的地方.
* entity(实体):映射数据库中的表,代表业务中的数据.
* Repository(仓储):仓储是像集合一样的对象,用来在数据源上检索和存储实体.在领域层定义,但是在基础设施层实现它.
* Domain service(领域服务):当业务操作多个实体时(大于1个),应该写在领域服务里.
* Domain Event(领域事件):用来定义特定于领域的事件,并触发使用它们.领域服务及实体(以及其他领域服务对象)一起实现了不属于单个实体的业务规则.
* Unit of Work(工作单元):工作单元是一种设计模式被用来管理数据连接和事务,以及追踪实体更改,并将这些更改保存到数据库中.它被定义在领域层中,但在基础设施层中实现他们.

## 1.3. 应用层(Application)

> 应用层提供一些应用服务(Application Service)方法供展现层调用.一个应用服务方法接受一个DTO(数据传输对象)作为输入参数.使用这个参数执行指定的领域操作,并根据结果返回另一个DTO.在展现层与到领域层之间不应该接收和返回entity(实体对象),应该进行DTO映射.一个应用服务方法通常被认为是一个工作单元(Unit of Work).用户输入参数的验证工作也应该在应用层实现.ABP提供了一个基础架构让我们很容易校验参数的有效性.建议使用AutoMapper来进行DTO与实体之间的映射.

## 1.4. 基础设施层(Infrastructure)

> 当在领域层中定义了仓储接口,应该在基础设施层中实现这些接口.

## 1.5. 展现层

* SPA:ABP模版使用了Anguler,却不限于此前端框架,但是提供了一些帮助类.
* MPA:客户端向服务器端发出请求，服务器端代码（ASP.NET MVC控制器）从数据库获得数据，并且使用Razor视图生成HTML。这些被生成后的HTML页面被发送回客户端显示。每显示一个新的页面都会整页刷新。
* SignalR:是一种从服务器到客户端发送推送通知的完美工具。

> SPA和MPA涉及到完全不同的体系结构，也有不同的应用场景。一个管理后台适合用SPA，博客就更适合用MPA，因为它更利于被搜索引擎抓取。

## 1.6. 其它

* ABP会自动处理服务器端返回的异常，并以友好的界面提示用户。
* 使用Castle Windsor为整个程序框架提供依赖注入的功能。
* 使用Log4Net日志记录组件，提供给其他各层调用以进行日志记录。